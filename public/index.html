<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MODIFIED: Title -->
    <title>ZanyTown - Modernized!</title>
    <!-- MODIFIED: Use new style.css -->
    <link rel="stylesheet" href="style.css">
    <!-- Load Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
    <!-- MODIFIED: New App Wrapper Structure -->
    <div id="app-wrapper">

        <!-- Loading Overlay (Remains similar, styled by CSS) -->
        <div id="loading-overlay">
            <div id="loading-message">Initializing ZanyTown...</div>
            <div class="spinner"></div> <!-- Added spinner -->
        </div>
        <!-- End Loading Overlay -->

        <!-- Header Bar (Remains similar, styled by CSS) -->
        <header id="main-header">
            <h1>ü§™ ZanyTown! ü§™</h1>
            <div id="room-name-display" class="header-info">Room: Loading...</div>
            <div id="player-currency" class="header-info">Silly Coins: ...</div>
            <button id="logout-btn" title="Log out and return to login screen">Bye Bye!</button>
        </header>

        <!-- Main Content Area (Contains Game World) -->
        <main id="main-content">

            <!-- Game World (Canvas + Overlays) -->
            <div id="game-world">
                <!-- Container for Canvas and Absolutely Positioned Panels -->
                <div id="game-container">
                    <canvas id="gameCanvas">
                        Uh oh! Your browser doesn't support the magic canvas!
                    </canvas>
                    <!-- Chat Bubbles Container (Overlays Canvas) -->
                    <div id="chat-bubbles-container"></div>

                    <!-- START: Toggled Panels (Positioned over canvas, initially hidden) -->

                    <!-- Inventory Panel -->
                    <div id="inventory-panel" class="toggle-panel ui-panel panel-column right" style="display: none;">
                        <button class="close-panel-btn" data-panel-id="inventory-panel" title="Close Inventory">X</button>
                        <h4>Your Junk</h4>
                        <div id="inventory-items" class="panel-content-scrollable">
                            <p><i>Connecting...</i></p>
                        </div>
                    </div>

                    <!-- User List Panel -->
                    <div id="user-list-panel" class="toggle-panel ui-panel panel-column left" style="display: none;">
                        <button class="close-panel-btn" data-panel-id="user-list-panel" title="Close Users">X</button>
                        <h4>Who's Here?</h4>
                        <ul id="user-list-content" class="panel-content-scrollable">
                            <li><i>Joining room...</i></li>
                        </ul>
                    </div>

                    <!-- Rooms Panel -->
                     <div id="rooms-panel" class="toggle-panel ui-panel panel-column left" style="display: none;">
                          <button class="close-panel-btn" data-panel-id="rooms-panel" title="Close Rooms">X</button>
                          <h4>Rooms</h4>
                          <div id="rooms-list-content" class="panel-content-scrollable">
                              <p><i>Fetching rooms...</i></p>
                          </div>
                      </div>

                    <!-- Admin Panel -->
                    <div id="admin-panel" class="toggle-panel ui-panel panel-column left" style="display: none;">
                         <button class="close-panel-btn" data-panel-id="admin-panel" title="Close Admin">X</button>
                         <h4>Admin Powers</h4>
                         <div class="panel-content-scrollable">
                             <button id="create-room-btn" title="Create a new empty room">Create Room</button>
                             <div id="admin-room-section" class="admin-section">
                                 <h5>Available Rooms</h5>
                                 <div id="admin-room-list" class="admin-list-box">
                                     <i>Loading rooms...</i>
                                 </div>
                             </div>
                             <div id="admin-layout-edit-section" class="admin-section">
                                 <h5>Layout Paint Type</h5>
                                 <div id="admin-layout-tile-type" class="admin-radio-group">
                                     <label><input type="radio" name="layout-paint-type" value="0" checked> Floor</label>
                                     <label><input type="radio" name="layout-paint-type" value="1"> Wall</label>
                                     <label><input type="radio" name="layout-paint-type" value="2"> AltFloor</label>
                                     <label><input type="radio" name="layout-paint-type" value="X"> Hole</label>
                                 </div>
                                 <p class="admin-instruction">(In Edit Mode, click tiles on map to paint)</p>
                             </div>
                         </div>
                    </div>

                    <!-- Debug Panel -->
                     <div id="debug-panel" class="toggle-panel ui-panel panel-column left" style="display: none;">
                         <button class="close-panel-btn" data-panel-id="debug-panel" title="Close Debug">X</button>
                         <h4>Nerd Stuff</h4>
                         <div id="debug-content" class="panel-content-scrollable">Initializing...</div>
                     </div>
                     <!-- END: Toggled Panels -->


                    <!-- START: Floating Panels (Profile, Recolor) -->
                    <div id="profile-panel" class="ui-panel floating-panel" style="display: none;">
                         <button id="profile-close-btn" class="close-btn" title="Close Profile">X</button>
                         <h4>Who Dat?</h4>
                         <div id="profile-content"></div>
                     </div>
                     <div id="recolor-panel" class="ui-panel floating-panel" style="display: none;">
                         <button id="recolor-close-btn" class="close-btn" title="Close Recolor">X</button>
                         <h4>Splash Some Color!</h4>
                         <p id="recolor-item-name">Item: ???</p>
                         <div id="recolor-swatches">
                             <p><i>Fetching colors...</i></p>
                         </div>
                         <button id="recolor-reset-btn" title="Reset to boring default color">Go Back!</button>
                     </div>
                     <!-- Shop Panel - Now a Toggle Panel -->
                     <div id="shop-panel" class="toggle-panel ui-panel panel-column right" style="display: none;">
                         <button class="close-panel-btn" data-panel-id="shop-panel" title="Close Shop">X</button>
                         <h4>Gizmo-Mart</h4>
                         <div id="shop-items" class="panel-content-scrollable">
                             <p><i>Stocking shelves...</i></p>
                         </div>
                     </div>
                     <!-- END: Floating Panels -->

                    <!-- Context Menu (Initially Hidden, positioned by JS) -->
                    <div id="context-menu" style="display: none;">
                        <ul>
                            <!-- Items populated by JS -->
                        </ul>
                    </div>

                </div> <!-- End #game-container -->

                <!-- Chat Area (Below Canvas Container) -->
                <div id="chat-area">
                    <div id="chat-log"></div>
                    <input type="text" id="chat-input" placeholder="Say something zany! Or type /help" autocomplete="off">
                </div>
            </div> <!-- End #game-world -->

        </main> <!-- End #main-content -->

        <!-- NEW: Bottom Bar -->
        <footer id="bottom-bar">
            <button id="toggle-inventory-btn" class="bottom-bar-btn" title="Inventory (I)"><span class="icon">üéí</span><span class="label">Junk</span></button>
            <button id="toggle-rooms-btn" class="bottom-bar-btn" title="Rooms"><span class="icon">üö™</span><span class="label">Rooms</span></button>
            <button id="toggle-users-btn" class="bottom-bar-btn" title="Users"><span class="icon">üë•</span><span class="label">Users</span></button>
            <button id="toggle-shop-btn" class="bottom-bar-btn" title="Shop"><span class="icon">üõí</span><span class="label">Shop</span></button>
            <button id="toggle-edit-bottom-btn" class="bottom-bar-btn" title="Toggle Build/Edit Mode (E)"><span class="icon">üî®</span><span class="label">Edit</span></button>
            <!-- Conditional Admin Button -->
            <button id="toggle-admin-btn" class="bottom-bar-btn" title="Admin Panel" style="display: none;"><span class="icon">üëë</span><span class="label">Admin</span></button>
             <!-- Debug Toggle Button -->
             <button id="toggle-debug-btn" class="bottom-bar-btn" title="Toggle Debug Info"><span class="icon">üêû</span><span class="label">Debug</span></button>
        </footer>

    </div> <!-- End #app-wrapper -->

    <!-- Scripts Remain the Same -->
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>